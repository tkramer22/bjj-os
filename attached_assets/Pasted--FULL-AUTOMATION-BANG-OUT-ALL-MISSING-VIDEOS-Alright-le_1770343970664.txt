ğŸš€ FULL AUTOMATION - BANG OUT ALL MISSING VIDEOS
Alright, letâ€™s automate the entire thing. Hereâ€™s the prompt:

REPLIT AGENT PROMPT - FULLY AUTOMATED BATCH ANALYSIS

CREATE FULLY AUTOMATED VIDEO ANALYSIS SYSTEM

GOAL: Automatically analyze ALL videos missing Gemini analysis in one automated process.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 1: CREATE AUTOMATED BATCH ENDPOINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create new endpoint: POST /api/admin/analyze-all-missing

This endpoint will:

1. Find ALL videos without Gemini analysis
2. Process them ALL automatically in batches
3. Continue until every video is analyzed
4. Handle errors gracefully
5. Return final results

IMPLEMENTATION:

const analyzeAllMissing = async (req, res) => {
  // Set timeout to 10 minutes (enough for full processing)
  req.setTimeout(600000);
  
  try {
    let totalProcessed = 0;
    let totalFailed = 0;
    let hasMore = true;
    
    // Keep processing until no more videos without analysis
    while (hasMore) {
      // Get next batch of 20 videos without analysis
      const videos = await pool.query(`
        SELECT id, video_id, title, professor_name, youtube_url
        FROM videos 
        WHERE gemini_analysis IS NULL 
           OR gemini_analysis = '' 
           OR gemini_analysis::text = '{}'
        ORDER BY id ASC
        LIMIT 20
      `);
      
      if (videos.rows.length === 0) {
        hasMore = false;
        break;
      }
      
      // Process this batch
      for (const video of videos.rows) {
        try {
          console.log(`Analyzing video ${video.id}: ${video.title}`);
          
          // Call your existing Gemini analysis function
          const analysis = await analyzeVideoWithGemini(video);
          
          // Save to database
          await pool.query(
            `UPDATE videos 
             SET gemini_analysis = $1, 
                 updated_at = NOW() 
             WHERE id = $2`,
            [JSON.stringify(analysis), video.id]
          );
          
          totalProcessed++;
          console.log(`âœ… Successfully analyzed video ${video.id}`);
          
        } catch (error) {
          totalFailed++;
          console.error(`âŒ Failed to analyze video ${video.id}:`, error.message);
          
          // Log failed video to database for retry later
          await pool.query(
            `INSERT INTO analysis_failures (video_id, error_message, created_at)
             VALUES ($1, $2, NOW())
             ON CONFLICT (video_id) DO UPDATE 
             SET error_message = $2, attempt_count = analysis_failures.attempt_count + 1`,
            [video.id, error.message]
          );
        }
        
        // Rate limiting: Wait 500ms between videos
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      console.log(`Batch complete. Processed: ${totalProcessed}, Failed: ${totalFailed}`);
    }
    
    res.json({
      success: true,
      totalProcessed,
      totalFailed,
      message: `Analysis complete! Processed ${totalProcessed} videos, ${totalFailed} failed.`
    });
    
  } catch (error) {
    console.error('Batch analysis error:', error);
    res.status(500).json({ 
      error: error.message,
      totalProcessed,
      totalFailed 
    });
  }
};

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 2: CREATE FAILURE TRACKING TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create table to track failures:

CREATE TABLE IF NOT EXISTS analysis_failures (
  id SERIAL PRIMARY KEY,
  video_id INTEGER UNIQUE NOT NULL,
  error_message TEXT,
  attempt_count INTEGER DEFAULT 1,
  created_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (video_id) REFERENCES videos(id) ON DELETE CASCADE
);

This lets us retry failed videos later.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3: ADD ADMIN UI WITH START BUTTON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

In admin dashboard, add:

function AnalysisDashboard() {
  const [isRunning, setIsRunning] = useState(false);
  const [stats, setStats] = useState(null);
  const [missingCount, setMissingCount] = useState(0);

  const startFullAnalysis = async () => {
    if (!confirm('This will analyze ALL missing videos. This may take 30-60 minutes and cost $70-175. Continue?')) {
      return;
    }
    
    setIsRunning(true);
    
    try {
      const response = await fetch('/api/admin/analyze-all-missing', {
        method: 'POST',
        credentials: 'include'
      });
      
      const data = await response.json();
      setStats(data);
      alert(`Complete! Processed: ${data.totalProcessed}, Failed: ${data.totalFailed}`);
      
    } catch (error) {
      alert('Error: ' + error.message);
    } finally {
      setIsRunning(false);
    }
  };

  return (
    <div className="analysis-dashboard">
      <h2>Automated Video Analysis</h2>
      
      <div className="stats">
        <p><strong>Total Videos:</strong> 5,335</p>
        <p><strong>Videos with Analysis:</strong> ~3,000</p>
        <p><strong>Videos Missing Analysis:</strong> ~{missingCount}</p>
        <p><strong>Estimated Cost:</strong> ${(missingCount * 0.025).toFixed(2)} - ${(missingCount * 0.05).toFixed(2)}</p>
        <p><strong>Estimated Time:</strong> {Math.ceil(missingCount * 0.5 / 60)} - {Math.ceil(missingCount / 60)} minutes</p>
      </div>
      
      <button 
        onClick={startFullAnalysis}
        disabled={isRunning}
        className="btn-primary"
      >
        {isRunning ? 'â³ Analyzing All Videos...' : 'ğŸš€ Start Full Analysis'}
      </button>
      
      {isRunning && (
        <div className="status">
          <p>âš™ï¸ Processing in background...</p>
          <p>This may take 30-60 minutes. You can close this page.</p>
          <p>Check server logs for progress.</p>
        </div>
      )}
      
      {stats && (
        <div className="results">
          <h3>Results</h3>
          <p>âœ… Successfully analyzed: {stats.totalProcessed}</p>
          <p>âŒ Failed: {stats.totalFailed}</p>
        </div>
      )}
    </div>
  );
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4: FIND YOUR EXISTING GEMINI ANALYSIS FUNCTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Search for where you're already calling Gemini API to analyze videos.

Look for:
- Function with "gemini" in the name
- Function that processes YouTube transcripts
- Where you store analysis results

You already have this working for 3,000 videos - find that code and reuse it.

TELL ME: What file contains your Gemini analysis function?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 5: RATE LIMITING & SAFETY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPORTANT SAFEGUARDS:

1. Process 20 videos per batch (not all at once)
2. 500ms delay between each video (prevents API rate limits)
3. Continue automatically until all done
4. Log failures but don't stop
5. Track progress in console logs

RATE LIMITS:
- Gemini API: ~60 requests per minute
- Our speed: ~120 videos per minute (with 500ms delay)
- Total time for 3,500 videos: ~30-60 minutes

COST ESTIMATE:
- Gemini pricing: ~$0.02-0.05 per video
- 3,500 videos: $70-$175 total
- This is a one-time cost

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 6: MONITORING & LOGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Add console logging so you can watch progress:

console.log('=== STARTING AUTOMATED ANALYSIS ===');
console.log(`Total videos to process: ${totalVideos}`);
console.log(`Estimated time: ${Math.ceil(totalVideos / 2)} minutes`);
console.log(`Estimated cost: $${(totalVideos * 0.025).toFixed(2)} - $${(totalVideos * 0.05).toFixed(2)}`);

During processing:
console.log(`[${totalProcessed}/${totalVideos}] Analyzing: ${video.title}`);

When complete:
console.log('=== ANALYSIS COMPLETE ===');
console.log(`âœ… Successfully processed: ${totalProcessed}`);
console.log(`âŒ Failed: ${totalFailed}`);
console.log(`â±ï¸ Total time: ${duration} minutes`);

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 7: RETRY FAILED VIDEOS ENDPOINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create second endpoint for retrying failures:

POST /api/admin/retry-failed-analysis

This endpoint:
1. Gets all videos from analysis_failures table
2. Tries to analyze them again
3. Removes from failures table if successful

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICATION CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After implementation, confirm:

â–¡ Created /api/admin/analyze-all-missing endpoint
â–¡ Created analysis_failures table
â–¡ Added admin UI with start button
â–¡ Found and integrated existing Gemini analysis function
â–¡ Added rate limiting (500ms between requests)
â–¡ Added error handling and failure tracking
â–¡ Added console logging for monitoring
â–¡ Tested with small batch first (20 videos)

TELL ME:
1. What file has your Gemini analysis function?
2. Did you create the endpoint successfully?
3. Did you create the admin UI?
4. Are you ready to test with a small batch?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
USAGE INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TO RUN FULL ANALYSIS:

1. Go to admin dashboard
2. Review stats and cost estimate
3. Click "ğŸš€ Start Full Analysis"
4. Confirm the popup
5. Watch Replit logs for progress
6. Wait 30-60 minutes for completion
7. Check results

You can close the browser - it runs in background on the server.

TO MONITOR PROGRESS:
- Open Replit logs
- Watch console output
- See real-time count of processed videos

TO RETRY FAILURES:
- After main run completes
- Click "Retry Failed Videos" button
- Only processes videos that failed first time

Show me when complete and I'll verify it's working correctly before you run the full batch!


WHAT THIS DOES:
âœ… Fully automated - Click once, it does everything
âœ… Processes ALL missing videos - No manual intervention needed
âœ… Runs in background - You can close browser
âœ… Safe rate limiting - Wonâ€™t hit API limits
âœ… Error handling - Logs failures, continues processing
âœ… Cost controlled - One-time payment of $70-175
âœ… Takes 30-60 minutes - Runs while you do other things

SEND THAT PROMPT TO REPLIT AGENT NOW! ğŸš€
Once itâ€™s implemented, youâ€™ll:
	1.	Click one button
	2.	Confirm the cost
	3.	Let it run
	4.	Come back in an hour
	5.	All videos analyzed âœ…â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
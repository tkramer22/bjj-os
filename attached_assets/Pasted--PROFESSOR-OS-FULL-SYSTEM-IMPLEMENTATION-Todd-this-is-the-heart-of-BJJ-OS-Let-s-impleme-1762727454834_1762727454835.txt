# **ğŸ§  PROFESSOR OS - FULL SYSTEM IMPLEMENTATION**

Todd, this is the heart of BJJ OS. Letâ€™s implement the **complete intelligent system** we designed.

-----

## **ğŸ¯ WHAT PROFESSOR OS NEEDS TO DO:**

### **Every Chat Request Must:**

1. âœ… Load YOUR complete profile (height, weight, belt, injuries, goals)
1. âœ… Build 6,000-8,000 character system prompt with personality
1. âœ… Load top 30 videos from database
1. âœ… Load last 10 conversation messages for context
1. âœ… Send ALL of this to GPT-4o
1. âœ… Save the conversation to database
1. âœ… Track patterns over time

### **The Result:**

- Responses feel like a **training partner who knows you**
- References **specific videos** that exist in your library
- Remembers **previous conversations**
- Has **personality** (black belt best friend, not corporate chatbot)
- **Learns** from your struggles and patterns

-----

## **ğŸ“‹ COPY THIS COMPLETE PROMPT TO REPLIT AGENT:**

```
# PROFESSOR OS - COMPLETE INTELLIGENT SYSTEM IMPLEMENTATION

## MISSION
Implement the full Professor OS system that makes every response personalized, intelligent, and connected to the user's journey.

## CRITICAL ARCHITECTURE

### STEP 1: Create buildSystemPrompt() Function

File: `server/utils/buildSystemPrompt.ts`

This function must:
1. Load complete user profile from database (including user table for email/username)
2. Load top 30 curated videos ranked by quality_score
3. Calculate days since user joined
4. Calculate user's age from birth_year
5. Build comprehensive 6,000-8,000 character system prompt with ALL sections

### STEP 2: Update Chat Endpoint

File: `server/routes.ts` (or wherever the /api/chat endpoint is)

The endpoint must:
1. Call buildSystemPrompt(userId) to get full system prompt
2. Load last 10 messages from chat_messages table for context
3. Send system prompt + history + new message to GPT-4o
4. Save both user message and AI response to database
5. Track model used and response time
6. Log system prompt length to console for verification

## DETAILED IMPLEMENTATION

### buildSystemPrompt.ts Structure:

```typescript
import { db } from '../db';
import { eq, desc } from 'drizzle-orm';
import { user_profiles, users, curated_videos } from '../db/schema';

export async function buildSystemPrompt(userId: string): Promise<string> {
  // 1. Load complete user profile including user table
  const profile = await db.query.user_profiles.findFirst({
    where: eq(user_profiles.user_id, userId),
    with: {
      user: {
        columns: {
          email: true,
          username: true,
          created_at: true
        }
      }
    }
  });

  if (!profile) {
    throw new Error('User profile not found');
  }

  // 2. Load top 30 videos from curated library
  const videos = await db.query.curated_videos.findMany({
    limit: 30,
    orderBy: [desc(curated_videos.quality_score)],
    columns: {
      id: true,
      title: true,
      instructor: true,
      technique_type: true,
      video_url: true
    }
  });

  // 3. Calculate metrics
  const daysSinceJoined = profile.user?.created_at 
    ? Math.floor((Date.now() - new Date(profile.user.created_at).getTime()) / (1000 * 60 * 60 * 24))
    : 0;
  
  const weeksSinceJoined = Math.floor(daysSinceJoined / 7);
  
  const age = profile.birth_year 
    ? new Date().getFullYear() - profile.birth_year 
    : null;

  // 4. Format video library for prompt
  const videoLibrary = videos.map((v, idx) => 
    `${idx + 1}. ${v.title} by ${v.instructor} (${v.technique_type})`
  ).join('\n');

  // 5. Build comprehensive system prompt
  const systemPrompt = `You are Professor OS, ${profile.first_name || profile.user?.username || 'this user'}'s BJJ training partner and coach.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 1: USER PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Name: ${profile.first_name || profile.user?.username || 'User'}
Email: ${profile.user?.email || 'Not provided'}
Username: ${profile.user?.username || 'Not provided'}

TRAINING PROFILE:
Belt Level: ${profile.belt_level || 'Not specified'}
Training Style: ${profile.training_style || 'Not specified'}
Training Frequency: ${profile.training_frequency || 'Not specified'} sessions per week
Biggest Struggle: ${profile.biggest_struggle || 'Not specified'}

PHYSICAL STATS:
Height: ${profile.height ? profile.height + ' inches (' + Math.floor(Number(profile.height) / 12) + "'" + (Number(profile.height) % 12) + '")' : 'Not provided'}
Weight: ${profile.weight ? profile.weight + ' lbs' : 'Not provided'}
Age: ${age ? age + ' years old' : 'Not provided'}

JOURNEY TOGETHER:
Days training together: ${daysSinceJoined} days
Weeks together: ${weeksSinceJoined} weeks

GOALS:
${profile.goals || 'Not specified yet'}

âš ï¸ INJURIES (CRITICAL - NEVER RECOMMEND ANYTHING THAT RISKS THESE):
${profile.injuries || 'None reported'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 2: CORE PHILOSOPHY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This is THEIR journey. You are their training partner, not a search engine.

REMEMBER:
- This is relational, not transactional
- Remember where they've been
- Care about their progress
- You're not a technique database - you're a training partner

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 3: PERSONALITY GUIDELINES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

You are their "black belt best friend" - direct, conversational, real coach energy.

âœ… DO:
- Use contractions (you're, let's, what's)
- Keep responses SHORT (2-4 sentences for first response)
- Direct, conversational tone
- Real coach language
- Celebrate wins genuinely
- Acknowledge difficulty honestly

âŒ DON'T:
- Corporate speak ("I understand this might be frustrating...")
- Robotic responses ("Let's explore some strategies...")
- Over-formality ("I shall provide instruction...")
- Say "as an AI..." or "Got it, [name]!"
- Excessive emojis or enthusiasm

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 4: RESPONSE LENGTH RULES (CRITICAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Keep responses SHORT and conversational.

First response to technical question: 2-4 sentences MAX
- Ask ONE diagnostic question
- Wait for their answer
- NO numbered lists immediately
- NO excessive bold formatting

Example:
User: "I'm struggling with guard passing"

âŒ BAD (too long):
"Guard passing can be challenging. Here are common issues:
 1. **Frame Management** 2. **Hip Control** 3. **Timing**"

âœ… GOOD (short & conversational):
"Guard passing getting you? Quick question: are you getting stuck 
 in closed guard or losing position when you pass?"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 5: VIDEO RECOMMENDATION RULES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WHEN TO RECOMMEND:
âœ… User explicitly asks for videos
âœ… After diagnostic conversation (identified specific problem)
âœ… User describes specific technical struggle
âœ… User wants to see an example

WHEN NOT TO RECOMMEND:
âŒ User just said "hi" or casual greeting
âŒ User asked off-topic question
âŒ First message in conversation (always diagnose first)
âŒ Before understanding their actual problem
âŒ Every single response (this is spam)

DIAGNOSTIC FLOW (ALWAYS FOLLOW THIS):
1. User mentions problem
2. YOU ask diagnostic question (2-3 sentences, short)
3. [WAIT for user's answer - NO videos yet]
4. User answers
5. YOU give specific advice OR offer video

Example Flow:
User: "I'm struggling with triangles"
You: "Triangles getting you? What's the main issue - breaking 
      posture or finishing?"
[WAIT - no videos yet]
User: "I can't break their posture"
You: "Okay, so it's posture-breaking. The key is getting high guard 
      first and using your legs, not hands. Want me to send you a 
      video that shows exactly how?"
[NOW can offer video]

VIDEO FORMAT:
[VIDEO: Title by Instructor | START: MM:SS]
URL (if available)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 6: AVAILABLE VIDEO LIBRARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

You have access to these curated videos (top 30):

${videoLibrary}

âš ï¸ CRITICAL: Only recommend videos that appear in this list!

If user asks about technique NOT in library:
"I don't have a specific video on that yet, but here's the principle..."

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 7: OFF-TOPIC HANDLING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When users ask non-BJJ questions:
1. Acknowledge briefly (don't ignore)
2. Redirect to BJJ with humor
3. Keep friendly

Examples:
User: "what's for dinner?"
You: "No idea! But if you're asking about nutrition for training, 
      I can help."

User: "tell me a joke"
You: "I'm better at chokes than jokes. Training today?"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 8: CONTEXT AWARENESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

You have conversation history. USE IT.

Repeated questions:
User: "how tall am I?" [asked again 30 seconds later]
You: "You literally just asked me that! Still ${profile.height ? Math.floor(Number(profile.height) / 12) + "'" + (Number(profile.height) % 12) + '"' : 'the same height'}."

Recurring problems:
User mentions "half guard" for 3rd time
You: "Half guard again - that's the third time you've mentioned it"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SECTION 9: PHYSICAL STATS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When user asks about their stats (height, weight, age):
- Answer DIRECTLY using profile data above
- DO NOT say "I don't know" - data is in profile above

User: "how tall am I?"
You: "You're ${profile.height ? Math.floor(Number(profile.height) / 12) + "'" + (Number(profile.height) % 12) + '"' : 'not sure - you haven't added your height to your profile yet'}"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REMEMBER: This is ${profile.first_name || 'their'} journey. You're their training partner, not a search engine. 
Care about their progress. Spot patterns. Guide intelligently. Keep responses 
conversational and SHORT.`;

  return systemPrompt;
}
```

### Chat Endpoint Update:

Find the POST /api/chat or /api/professor-os or similar endpoint and replace with:

```typescript
app.post('/api/chat/professor-os', requireAuth, async (req, res) => {
  try {
    const userId = req.user.id;
    const { message } = req.body;

    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('PROFESSOR OS REQUEST');
    console.log('User ID:', userId);
    console.log('Message:', message);

    // 1. Build comprehensive system prompt
    const systemPrompt = await buildSystemPrompt(userId);
    console.log('System prompt length:', systemPrompt.length, 'characters');
    console.log('âš ï¸ Should be 6000-8000. If <2000, system not connected properly.');

    // 2. Load conversation history (last 10 messages)
    const history = await db.query.chat_messages.findMany({
      where: eq(chat_messages.user_id, userId),
      orderBy: [asc(chat_messages.created_at)],  // ASC for correct chronological order
      limit: 10
    });
    console.log('Loaded conversation history:', history.length, 'messages');

    // 3. Format messages for GPT-4o
    const messages = history.map(msg => ({
      role: msg.role as 'user' | 'assistant',
      content: msg.content
    }));
    messages.push({ role: 'user', content: message });

    // 4. Call GPT-4o with FULL context
    const startTime = Date.now();
    const response = await openai.chat.completions.create({
      model: 'gpt-4o',
      max_tokens: 2048,
      temperature: 0.7,
      messages: [
        { role: 'system', content: systemPrompt },  // â† FULL 8K PROMPT HERE
        ...messages
      ]
    });

    const aiResponse = response.choices[0]?.message?.content || 'Sorry, I had trouble generating a response.';
    const responseTime = Date.now() - startTime;
    
    console.log('Response generated in:', responseTime, 'ms');
    console.log('Response preview:', aiResponse.substring(0, 100) + '...');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    // 5. Save both messages to database
    await db.insert(chat_messages).values([
      {
        user_id: userId,
        role: 'user',
        content: message,
        created_at: new Date()
      },
      {
        user_id: userId,
        role: 'assistant',
        content: aiResponse,
        model_used: 'gpt-4o',
        response_time_ms: responseTime,
        created_at: new Date()
      }
    ]);

    // 6. Return response
    res.json({
      message: aiResponse,
      metadata: {
        model: 'gpt-4o',
        responseTime: responseTime,
        systemPromptLength: systemPrompt.length
      }
    });

  } catch (error) {
    console.error('âŒ PROFESSOR OS ERROR:', error);
    res.status(500).json({ error: 'Failed to generate response' });
  }
});
```

## VERIFICATION REQUIREMENTS

After implementing, test with these queries and show me console output:

1. â€œhey whatâ€™s upâ€ â†’ Should NOT recommend videos
1. â€œhow tall am I?â€ â†’ Should answer directly from profile
1. â€œIâ€™m struggling with guard passingâ€ â†’ Should ask diagnostic question, NO videos yet
1. â€œI want the videoâ€ â†’ Should now offer actual video from library

Console logs should show:
âœ“ â€œSystem prompt length: 6543 charactersâ€ (must be 6000-8000)
âœ“ â€œLoaded conversation history: 4 messagesâ€
âœ“ â€œResponse generated in: 2341 msâ€

If system prompt length < 2000, something is wrong.

## DATABASE SCHEMA VERIFICATION

Confirm these tables exist with correct columns:

- users (id, email, username, created_at)
- user_profiles (user_id, first_name, belt_level, training_style, biggest_struggle, height, weight, birth_year, training_frequency, goals, injuries)
- chat_messages (id, user_id, role, content, model_used, response_time_ms, created_at)
- curated_videos (id, title, instructor, technique_type, quality_score, video_url)

If any columns are missing, add them.

## IMPLEMENTATION CHECKLIST

â˜ Create buildSystemPrompt.ts with complete prompt generation
â˜ Update chat endpoint to use buildSystemPrompt()
â˜ Add comprehensive console logging
â˜ Save all messages to database
â˜ Load conversation history for context
â˜ Test with 4 verification queries
â˜ Confirm console shows 6000-8000 character prompt
â˜ Confirm responses have personality
â˜ Confirm videos are only recommended appropriately
â˜ Confirm physical stats queries work (â€œhow tall am I?â€)

Show me the implementation and test results.

```
---

## **ğŸ¯ WHAT THIS WILL FIX:**

### **Before (What you're seeing now):**
- âŒ Generic chatbot responses
- âŒ "Got it, Todd!" cheerful corporate speak
- âŒ No actual video links
- âŒ Doesn't know your height/weight
- âŒ No conversation memory
- âŒ Recommends videos that don't exist

### **After (What you'll get):**
- âœ… Personalized responses that know YOU
- âœ… Direct, conversational tone
- âœ… Actual videos from your 465-video library
- âœ… Remembers previous conversations
- âœ… Knows your height, weight, belt, goals, injuries
- âœ… Diagnostic questioning before solutions
- âœ… Short, focused responses (2-4 sentences)

---

## **â±ï¸ ESTIMATED TIME:**

- **Implementation:** 20-30 minutes (Replit Agent will build it)
- **Testing:** 10-15 minutes (verify it works)
- **Total:** 30-45 minutes to complete Professor OS system

---

**ğŸš€ Copy that entire prompt to Replit Agent now. This implements the full intelligent system you designed.** Let me know when Agent starts working on it!â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
```
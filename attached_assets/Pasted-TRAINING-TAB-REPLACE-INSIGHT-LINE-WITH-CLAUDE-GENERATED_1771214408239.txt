TRAINING TAB â€” REPLACE INSIGHT LINE WITH CLAUDE-GENERATED ONE-LINER

âš ï¸ DO NOT break any existing functionality.
âš ï¸ DO NOT touch Professor OS chat, video library, video curation, or profile.
âš ï¸ Only modify the Training tab insight line and its backend endpoint.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
WHAT WEâ€™RE CHANGING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The Training tab currently has a rule-based insight line between the
streak counter and the calendar. We are replacing the static template
system with a short Claude API call that generates a fresh, contextual
one-liner every time.

We are also REMOVING the ğŸ§  brain emoji from the insight line.
No emoji on the insight. Just text. Clean.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BACKEND: NEW ENDPOINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Replace or update: GET /api/training/insight

This endpoint:

1. Queries the userâ€™s training data
1. Sends a short Claude API call
1. Returns a one-liner string
1. Caches the result for 1 hour per user OR until a new session is saved

STEP 1 â€” GATHER USER TRAINING STATS:

Query the following for the authenticated user:

const stats = {
sessionsThisWeek: // count of sessions in last 7 days
sessionsLastWeek: // count of sessions 8-14 days ago
sessionsThisMonth: // count of sessions this calendar month
sessionsLastMonth: // count of sessions last calendar month
totalSessions: // total all-time session count
currentStreak: // consecutive days with sessions (existing logic)
daysSinceLastSession: // days since most recent session
techniquesThisWeek: // array of {name, count} for techniques logged in last 7 days, ordered by count DESC
mostLoggedTechniqueAllTime: // {name, count} â€” single most logged technique ever
lastSessionDate: // date of most recent session
lastSessionMood: // mood of most recent session
recentTechniques: // last 5 unique techniques logged
};

STEP 2 â€” CALL CLAUDE:

Use the same Claude client/API key already configured for Professor OS.
Model: claude-haiku-4-5-20251001 (cheapest, fastest â€” sufficient for one sentence)
Max tokens: 60

System prompt:
â€œYou are Professor OS â€” an elite BJJ black belt coach and training
partner. Youâ€™ve been coaching this student for months. You know their
game, their habits, their patterns. You talk like a real coach in the
gym â€” the way JT Torres or John Danaher would speak to a dedicated
student between rounds. Warm but direct. Knowledgeable. You respect
them enough to be honest. Occasionally dry humor. Youâ€™re proud of them
when they earn it. You push them when they need it. You never
patronize.

You are glancing at their training log and making ONE brief comment.
Like a coach walking past the whiteboard and saying something in
passing before moving on.

STRICT RULES:

- One sentence only. Maximum 15 words. No exceptions.
- No emojis. No exclamation marks. No question marks.
- Reference specific numbers or techniques from their data.
- Never generic motivation. If it could apply to anyone, donâ€™t say it.
- Never say: â€˜keep it upâ€™, â€˜great jobâ€™, â€˜you got thisâ€™, â€˜proud of youâ€™,
  â€˜keep pushingâ€™, â€˜stay consistentâ€™, â€˜believe in yourselfâ€™, or anything
  that sounds like a motivational poster.
- DO say things a real coach would say â€” observations about their
  patterns, technique focus, volume, rest, progress, or habits.
- Vary your tone â€” sometimes encouraging, sometimes a nudge, sometimes
  just a factual observation that makes them think.
- If they train a lot, acknowledge the work without being sycophantic.
- If they havenâ€™t trained recently, be direct but human about it.
- If they keep drilling the same technique, thatâ€™s worth noting.
- If their volume changed from last week or last month, mention it.â€

User message:
Send the stats object as a formatted string:

â€œHere is my studentâ€™s training data:

- Sessions this week: {sessionsThisWeek}
- Sessions last week: {sessionsLastWeek}
- Sessions this month: {sessionsThisMonth}
- Sessions last month: {sessionsLastMonth}
- Total sessions all-time: {totalSessions}
- Current streak: {currentStreak} days
- Days since last session: {daysSinceLastSession}
- Techniques this week: {techniquesThisWeek formatted as â€˜Armbar (3), Half Guard (2)â€™}
- Most logged technique all-time: {mostLoggedTechniqueAllTime}
- Last session mood: {lastSessionMood}

Give one observation.â€

STEP 3 â€” CACHE THE RESULT:

Store the Claude response in an in-memory cache (or Redis if available):

- Key: `training_insight_${userId}`
- Value: the insight string
- TTL: 1 hour

INVALIDATE the cache when:

- User saves a new training session (POST /api/training/sessions)
- User deletes a training session (DELETE /api/training/sessions/:id)
- User updates a training session (PUT /api/training/sessions/:id)

After invalidation, the NEXT time the Training tab loads, it will
generate a fresh insight from Claude with the updated data.

STEP 4 â€” RETURN:

Response: { insight: â€œstringâ€ }

If Claude call fails for any reason (timeout, rate limit, error):

- Return a fallback: { insight: â€œOne session at a time.â€ }
- Log the error server-side
- Do NOT crash or show an error to the user

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FRONTEND: UPDATE TRAINING TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REMOVE the ğŸ§  brain emoji from the insight line completely.

The insight line should render as plain text only. No emoji prefix.
Same styling as before:

- Muted white text (white at 70-80% opacity)
- 14px font size
- Same horizontal padding as rest of the tab
- Sits between streak counter and calendar

LOADING BEHAVIOR:

1. Training tab renders immediately with streak counter and calendar
1. Insight line area is empty (no placeholder, no skeleton, no spinner)
1. Fetch GET /api/training/insight in the background
1. When response arrives, fade the insight text in (300ms ease-in)
1. If the fetch takes more than 3 seconds, skip it â€” donâ€™t show anything

INTERACTION BEHAVIOR (same as before):

- Bottom sheet opens â†’ insight fades out (200ms)
- Bottom sheet closes after save â†’ re-fetch fresh insight (cache was
  invalidated by the save), fade in new one
- Bottom sheet closes without save â†’ previous insight fades back in
  (no re-fetch needed, use cached version)

TAB SWITCHING:

- When user leaves Training tab and comes back within 1 hour â†’
  show cached insight immediately (no fade, instant)
- When user comes back after 1 hour â†’ re-fetch and fade in

ZERO STATE:

- If user has ZERO sessions ever logged â†’ do NOT call Claude,
  do NOT show any insight line. Just show â€œLog a session to start
  your streakâ€ as the streak text. Thatâ€™s enough.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¡ Training tab loads without delay (insight appears after a beat)
â–¡ Insight text has NO emoji â€” just plain text
â–¡ Insight references actual user data (technique names, session counts)
â–¡ Insight is one sentence, under 15 words
â–¡ Insight tone is direct coach voice, not generic motivation
â–¡ Tapping a date â†’ insight fades out
â–¡ Saving a session â†’ NEW insight appears (not the old cached one)
â–¡ Dismissing bottom sheet without save â†’ old insight returns
â–¡ User with zero sessions â†’ no insight line shown at all
â–¡ If Claude API fails â†’ shows â€œOne session at a time.â€ as fallback
â–¡ No visible loading spinner or skeleton for the insight
â–¡ Switching tabs and coming back â†’ insight still there (cached)
â–¡ After 1 hour â†’ fresh insight generated on next tab load
â–¡ Insight never shows generic phrases like â€œkeep it upâ€ or â€œgreat jobâ€
â–¡ Test with different data scenarios:

- User who trained 6 days this week
- User who hasnâ€™t trained in 5 days
- User who logged the same technique 4 times
- User who just hit 50 total sessions
- User who trained more this month than last month

DO NOT publish until I confirm the insight messages look right.
Show me 5 different example insights from the preview before deploying.
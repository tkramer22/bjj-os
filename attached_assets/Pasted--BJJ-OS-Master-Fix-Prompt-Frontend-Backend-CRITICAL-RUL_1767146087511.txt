```
BJJ OS - Master Fix Prompt (Frontend + Backend)

CRITICAL RULES:
- Everything stays IN-APP. No external browser redirects, no opening external URLs, no Clerk hosted pages. All flows must be native within the app.
- Do NOT break any existing functionality
- Test each fix individually before moving to the next

===================================================
FIX 1: CHAT SCROLL POSITION
===================================================
Location: client/src/pages/chat-mobile.tsx (or wherever the Chat component lives)

Problem: When users navigate from Videos, Saved, or Profile tabs back to Chat, the chat shows oldest messages first and requires scrolling.

Fix: Chat MUST automatically be positioned at the bottom showing the most recent messages instantly. No scrolling required.

Implementation:
- Add a ref to track the end of the messages container
- Add useEffect that scrolls to bottom on component mount
- Add useEffect that scrolls to bottom when messages array changes
- Use behavior: 'auto' (NOT 'smooth') for instant positioning - no visible scroll animation
- Trigger scroll to bottom when the Chat tab becomes active/focused (navigation listener)

const messagesEndRef = useRef<HTMLDivElement>(null);

const scrollToBottom = () => {
  messagesEndRef.current?.scrollIntoView({ behavior: 'auto' });
};

useEffect(() => {
  scrollToBottom();
}, []);

useEffect(() => {
  scrollToBottom();
}, [messages]);

Add <div ref={messagesEndRef} /> at the very end of the messages container.

Ensure this triggers on EVERY tab navigation back to Chat, not just initial app load.

===================================================
FIX 2: HAPTIC FEEDBACK ON PICKERS
===================================================
Location: Profile component where weight, height, and belt pickers exist

Add haptic feedback to ALL picker/scroll wheel interactions:
- Weight picker
- Height picker  
- Belt selection picker

Install Capacitor Haptics if not already installed:
npm install @capacitor/haptics

Import and use:

import { Haptics, ImpactStyle } from '@capacitor/haptics';

For each picker's onChange handler:

const handleWeightChange = (newValue) => {
  Haptics.impact({ style: ImpactStyle.Light });
  setWeight(newValue);
};

const handleHeightChange = (newValue) => {
  Haptics.impact({ style: ImpactStyle.Light });
  setHeight(newValue);
};

const handleBeltChange = (newValue) => {
  Haptics.impact({ style: ImpactStyle.Light });
  setBelt(newValue);
};

Use ImpactStyle.Light for subtle "tick" feedback on each value change.

===================================================
FIX 3: RESET PASSWORD BUTTON
===================================================
Location: Settings screen component (Profile → App Settings → Settings page)

Add a "Reset Password" row in the ACCOUNT section, directly below the Email row.

Visual design:
- Lock icon on the left (use existing icon library)
- Label: "Reset Password"
- Chevron arrow on the right (match other navigable rows)
- Style identically to the Email row

Behavior:
- On tap: trigger haptic feedback using Haptics.impact({ style: ImpactStyle.Medium })
- Handle password reset fully IN-APP using Clerk's SDK
- Do NOT redirect to any external browser or URL
- Show in-app modal or screen for the reset flow
- Display confirmation message when reset email is sent

Example using Clerk:

import { useUser } from '@clerk/clerk-react';
import { Haptics, ImpactStyle } from '@capacitor/haptics';

const { user } = useUser();

const handleResetPassword = async () => {
  Haptics.impact({ style: ImpactStyle.Medium });
  try {
    await user?.updatePassword({ currentPassword: '', newPassword: '' });
    // Or trigger password reset email flow
    // Show success modal/toast: "Password reset email sent!"
  } catch (error) {
    // Show error modal/toast
  }
};

The flow must stay entirely within the app.

===================================================
FIX 4: PROFILE PHOTO EDIT BADGE
===================================================
Location: Profile screen component, the camera/edit icon overlay on profile photo

Problem: The small purple camera/edit icon is hard to see.

Fix (implement whichever looks best):
- Increase icon size by ~30-40%
- Add a white border (2px solid white) around the circular badge
- Add a subtle drop shadow: boxShadow: '0 2px 4px rgba(0,0,0,0.3)'
- Ensure the badge background is fully opaque purple, not semi-transparent

Goal: Make it immediately obvious that tapping the photo allows editing.

===================================================
FIX 5: BOTTOM NAV ACTIVE STATE
===================================================
Location: Bottom navigation/tab bar component

Problem: Active tab needs stronger visual indication for native iOS feel.

Current: Active tab has purple icon + label (good but needs more)

Enhancement - Add ONE of these to the active tab:
Option A: Subtle top border - 2-3px purple line above the active icon
Option B: Pill background - subtle semi-transparent purple pill behind the active icon/label

Example for Option A:
borderTop: isActive ? '2px solid #8B5CF6' : 'none'

Example for Option B:
background: isActive ? 'rgba(139, 92, 246, 0.15)' : 'transparent'
borderRadius: '12px'
padding: '4px 12px'

Keep it subtle. Goal is native iOS tab bar feel.

===================================================
FIX 6: CHAT INPUT FIELD BORDER RADIUS
===================================================
Location: Chat screen, the text input at bottom ("Ask Professor OS...")

Problem: Input field needs more rounded pill shape like native iOS Messages.

Fix: Increase border radius to create pill/capsule shape.

Change border-radius from current value to: 20px or 24px

Ensure:
- Microphone button still integrates properly
- Send button still integrates properly
- Placeholder text is still visible and properly padded

===================================================
FIX 7: GEMINI VIDEO CLEANUP (BACKEND)
===================================================
Location: Server-side, video processing/database management

Task: Clean up videos that don't have Gemini analysis data.

Step 1 - Re-attempt Gemini scan:
- Query the database for ALL videos where Gemini analysis data is missing/null/incomplete
- For each video found, attempt ONE more Gemini scan/analysis
- Log each attempt (success or failure)

Step 2 - Delete failures:
- After all re-scan attempts complete, query again for videos still missing Gemini data
- DELETE these videos from the database entirely (they are stale/broken)
- Log how many videos were deleted

Implementation approach:

async function cleanupUnscannedVideos() {
  // Step 1: Find videos without Gemini data
  const unscannedVideos = await db.select()
    .from(videos)
    .where(isNull(videos.geminiAnalysis)); // adjust field name as needed
  
  console.log(`Found ${unscannedVideos.length} videos without Gemini analysis`);
  
  // Step 2: Attempt to scan each one
  for (const video of unscannedVideos) {
    try {
      await scanVideoWithGemini(video.id);
      console.log(`Successfully scanned video: ${video.id}`);
    } catch (error) {
      console.log(`Failed to scan video: ${video.id}`, error.message);
    }
  }
  
  // Step 3: Delete any that still don't have data
  const stillUnscanned = await db.select()
    .from(videos)
    .where(isNull(videos.geminiAnalysis));
  
  if (stillUnscanned.length > 0) {
    await db.delete(videos)
      .where(isNull(videos.geminiAnalysis));
    console.log(`Deleted ${stillUnscanned.length} videos that failed Gemini scan`);
  }
  
  console.log('Video cleanup complete');
}

Run this cleanup function once. This can be triggered manually or as a one-time script.

===================================================
AFTER ALL CHANGES:
===================================================
1. Test each fix in Replit preview
2. Commit to GitHub
3. Pull to local machine
4. Run: npx cap sync ios
5. Build in Xcode
6. Test all 7 fixes on device/simulator

===================================================
```
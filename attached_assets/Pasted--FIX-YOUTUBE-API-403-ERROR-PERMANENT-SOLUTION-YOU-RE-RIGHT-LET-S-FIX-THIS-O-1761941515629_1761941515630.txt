# **FIX YOUTUBE API 403 ERROR - PERMANENT SOLUTION** ğŸ”§

-----

## **YOUâ€™RE RIGHT - LETâ€™S FIX THIS ONCE AND FOR ALL**

This has been a recurring issue. Letâ€™s solve it properly so you never have to deal with it again.

-----

**Copy this entire prompt and paste into Replit Agent:**

-----

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
YOUTUBE API 403 ERROR - PERMANENT FIX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEM: YouTube API returning 403 errors, blocking auto-curation
FREQUENCY: This keeps happening repeatedly
GOAL: Fix it permanently so it never breaks again

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PHASE 1: DIAGNOSE THE ACTUAL PROBLEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

YouTube API 403 errors have multiple possible causes:

1. API KEY ISSUES:
   â–¡ Invalid API key
   â–¡ API key not enabled for YouTube Data API v3
   â–¡ API key has domain/IP restrictions blocking Replit
   â–¡ API key was regenerated but .env not updated

2. QUOTA ISSUES:
   â–¡ Daily quota exceeded (10,000 units/day default)
   â–¡ Per-minute rate limit exceeded
   â–¡ Billing not enabled on Google Cloud project

3. API CONFIGURATION ISSUES:
   â–¡ YouTube Data API v3 not enabled in Google Cloud Console
   â–¡ Wrong API endpoint being called
   â–¡ Missing required parameters in API request

4. REQUEST ISSUES:
   â–¡ Malformed request URL
   â–¡ Missing required headers
   â–¡ Invalid search parameters

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 1: CHECK CURRENT API KEY & CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

First, let's see what we're working with:

1. CHECK ENVIRONMENT VARIABLE:
   ```bash
   echo $YOUTUBE_API_KEY
```

- Does it exist?
- Is it a valid format (39 characters, alphanumeric)?
- Is it the correct key from Google Cloud Console?

1. LOCATE YOUTUBE API CODE:
   Find all files that use YouTube API:
   
   ```bash
   grep -r "YOUTUBE_API_KEY" . --exclude-dir=node_modules
   grep -r "youtube.googleapis.com" . --exclude-dir=node_modules
   grep -r "googleapis" . --include="*.ts" --include="*.js"
   ```
1. REVIEW THE CODE:

- What file makes YouTube API calls?
- Whatâ€™s the exact API endpoint URL?
- What parameters are being sent?
- How is the API key being used?
- Show me the actual HTTP request being made

1. CHECK LOGS FOR EXACT ERROR:
   Look for recent YouTube API errors in logs:

- Whatâ€™s the exact error message?
- Whatâ€™s the HTTP response body?
- Is it 403 Forbidden or something else?
- Are there any additional error details?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 2: VERIFY GOOGLE CLOUD CONSOLE CONFIGURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Provide me with instructions to verify (Iâ€™ll check manually):

What I need to verify in Google Cloud Console:

1. YouTube Data API v3 is ENABLED
1. API key exists and is ACTIVE (not deleted/disabled)
1. API key restrictions (if any):

- HTTP referrers: Should be NONE or include replit.app
- IP addresses: Should be NONE (Replit IPs change)
- API restrictions: Should include â€œYouTube Data API v3â€

1. Quota status:

- Daily limit: 10,000 units
- Current usage: X/10,000
- Any quota exceeded errors?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3: TEST API KEY DIRECTLY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Create a simple test script to isolate the issue:

Create: server/test-youtube-api.ts

```typescript
import fetch from 'node-fetch';

async function testYouTubeAPI() {
  const apiKey = process.env.YOUTUBE_API_KEY;
  
  if (!apiKey) {
    console.error('âŒ YOUTUBE_API_KEY not found in environment');
    return;
  }

  console.log('ğŸ”‘ API Key found:', apiKey.substring(0, 10) + '...');
  console.log('ğŸ”‘ API Key length:', apiKey.length);

  // Test 1: Simple search
  const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=brazilian+jiu+jitsu&type=video&maxResults=1&key=${apiKey}`;
  
  console.log('\nğŸ“¡ Testing YouTube API search...');
  console.log('URL:', searchUrl.replace(apiKey, 'API_KEY_HIDDEN'));

  try {
    const response = await fetch(searchUrl);
    const status = response.status;
    const statusText = response.statusText;
    
    console.log(`\nğŸ“Š Response Status: ${status} ${statusText}`);
    
    if (status === 200) {
      const data = await response.json();
      console.log('âœ… SUCCESS! API is working');
      console.log('Results:', data.items?.length || 0, 'videos found');
      console.log('Sample video:', data.items?.[0]?.snippet?.title);
      return { success: true, data };
    } else {
      const errorBody = await response.text();
      console.error('âŒ FAILED! Error details:');
      console.error('Status:', status);
      console.error('Status Text:', statusText);
      console.error('Response Body:', errorBody);
      
      // Parse error if JSON
      try {
        const errorJson = JSON.parse(errorBody);
        console.error('\nğŸ“‹ Parsed Error:');
        console.error('Message:', errorJson.error?.message);
        console.error('Reason:', errorJson.error?.errors?.[0]?.reason);
        console.error('Domain:', errorJson.error?.errors?.[0]?.domain);
      } catch (e) {
        // Not JSON, already printed raw body
      }
      
      return { success: false, status, error: errorBody };
    }
  } catch (error) {
    console.error('âŒ EXCEPTION:', error.message);
    return { success: false, error: error.message };
  }
}

// Run test
testYouTubeAPI().then(result => {
  console.log('\n' + 'â•'.repeat(80));
  if (result?.success) {
    console.log('âœ… YOUTUBE API TEST PASSED');
    console.log('The API key is valid and working correctly.');
  } else {
    console.log('âŒ YOUTUBE API TEST FAILED');
    console.log('Fix the issue above before proceeding with curation.');
  }
  console.log('â•'.repeat(80));
});
```

Run this test script:

```bash
npx tsx server/test-youtube-api.ts
```

Report the EXACT output.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4: COMMON FIXES FOR 403 ERRORS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Based on the test results, apply the appropriate fix:

FIX 1: API KEY RESTRICTIONS TOO STRICT
If error mentions â€œAPI key not validâ€ or â€œIP address blockedâ€:

Action: In Google Cloud Console:

1. Go to APIs & Services > Credentials
1. Click your API key
1. Under â€œApplication restrictionsâ€: Select â€œNoneâ€
1. Under â€œAPI restrictionsâ€: Select â€œDonâ€™t restrict keyâ€ OR ensure â€œYouTube Data API v3â€ is checked
1. Save
1. Wait 5 minutes for changes to propagate
1. Re-run test

FIX 2: API NOT ENABLED
If error mentions â€œYouTube Data API has not been usedâ€:

Action: In Google Cloud Console:

1. Go to APIs & Services > Library
1. Search â€œYouTube Data API v3â€
1. Click it
1. Click â€œEnableâ€
1. Wait 2 minutes
1. Re-run test

FIX 3: QUOTA EXCEEDED
If error mentions â€œquotaExceededâ€:

Action:

1. Check quota usage in Google Cloud Console
1. If over limit, wait until midnight Pacific Time (quota resets)
1. OR request quota increase (takes 2-3 days)
1. Temporary fix: Lower daily_video_target in curation_config to 20-30

FIX 4: BILLING NOT ENABLED
If error mentions â€œbillingâ€ or quota is 0:

Action:

1. In Google Cloud Console, enable billing
1. Add payment method
1. Billing is required for APIs even with free tier
1. Re-run test

FIX 5: WRONG API KEY
If all else fails:

Action: Generate new API key

1. Google Cloud Console > APIs & Services > Credentials
1. Create Credentials > API Key
1. Copy new key
1. Update .env: YOUTUBE_API_KEY=new_key_here
1. Restart Replit
1. Re-run test

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 5: UPDATE CURATION CODE WITH BETTER ERROR HANDLING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Once API is working, improve the curation code to handle errors gracefully:

Find the curation code (likely server/services/continuousCuration.ts or similar)
and update it with:

```typescript
async function searchYouTubeVideos(query: string, maxResults: number = 50) {
  const apiKey = process.env.YOUTUBE_API_KEY;
  
  if (!apiKey) {
    throw new Error('YOUTUBE_API_KEY not configured');
  }

  const url = `https://www.googleapis.com/youtube/v3/search?` +
    `part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=${maxResults}&key=${apiKey}`;

  try {
    const response = await fetch(url);
    
    if (!response.ok) {
      const errorBody = await response.text();
      let errorDetails = '';
      
      try {
        const errorJson = JSON.parse(errorBody);
        errorDetails = errorJson.error?.message || errorBody;
      } catch {
        errorDetails = errorBody;
      }
      
      // Log detailed error for debugging
      console.error('YouTube API Error:', {
        status: response.status,
        statusText: response.statusText,
        error: errorDetails,
        query: query
      });
      
      // Throw specific error based on status code
      if (response.status === 403) {
        if (errorDetails.includes('quotaExceeded')) {
          throw new Error('YouTube API quota exceeded. Curation paused until midnight PT.');
        } else if (errorDetails.includes('API key not valid')) {
          throw new Error('YouTube API key invalid. Check Google Cloud Console configuration.');
        } else {
          throw new Error(`YouTube API 403 Forbidden: ${errorDetails}`);
        }
      } else if (response.status === 400) {
        throw new Error(`YouTube API bad request: ${errorDetails}`);
      } else {
        throw new Error(`YouTube API error (${response.status}): ${errorDetails}`);
      }
    }

    const data = await response.json();
    return data.items || [];
    
  } catch (error) {
    // Log to curation_runs table
    console.error('YouTube API call failed:', error.message);
    throw error;
  }
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 6: ADD MONITORING & ALERTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Update curation system to alert on YouTube API issues:

1. Log YouTube API errors to curation_runs table
1. Dev OS should detect and alert on repeated API failures
1. Email alert if YouTube API fails 3+ times in a row

Add to curation_runs table:

```sql
ALTER TABLE curation_runs ADD COLUMN IF NOT EXISTS youtube_api_error TEXT;
ALTER TABLE curation_runs ADD COLUMN IF NOT EXISTS youtube_api_error_count INTEGER DEFAULT 0;
```

Update curation code to track errors:

```typescript
try {
  const videos = await searchYouTubeVideos(query);
  // ... process videos
} catch (error) {
  await db.update(curationRuns)
    .set({
      youtubeApiError: error.message,
      youtubeApiErrorCount: sql`${curationRuns.youtubeApiErrorCount} + 1`,
      status: 'failed'
    })
    .where(eq(curationRuns.id, runId));
  
  throw error;
}
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 7: VERIFY FIX & RESUME CURATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After implementing fixes:

1. Run test script again: npx tsx server/test-youtube-api.ts
1. Verify: âœ… SUCCESS! API is working
1. Manually trigger curation: POST /api/admin/curation/run
1. Verify: New videos added without 403 errors
1. Check curation_runs table: status = â€˜completedâ€™, no errors

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
REPORT BACK WITH:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Current API key status (from Step 1)
1. Exact error message from test script (Step 3)
1. Which fix was applied (Step 4)
1. Test results after fix (Step 7)

After this is fixed, it should NEVER break again because:
âœ… Proper error handling added
âœ… Monitoring in place
âœ… API key configuration validated
âœ… Test script available for future debugging

Letâ€™s fix this permanently. Begin diagnosis now.

```
---

## **WHY THIS KEEPS HAPPENING:**

The YouTube API 403 issue keeps recurring because:

1. **No proper error handling** - When it fails, we don't know why
2. **No monitoring** - We don't detect failures proactively  
3. **API key restrictions** - Google Cloud config may be too strict for Replit
4. **Quota management** - May be hitting daily limits
5. **Configuration drift** - Settings change and we lose track

**This fix addresses ALL of these root causes permanently.**

---

## **WHAT THIS FIX DOES:**
```

1. âœ… Creates diagnostic test script (isolate the issue)
1. âœ… Provides step-by-step troubleshooting (find root cause)
1. âœ… Gives specific fixes for each scenario (403, quota, config)
1. âœ… Adds robust error handling (graceful failures)
1. âœ… Implements monitoring (detect future issues)
1. âœ… Validates the fix (verify it works)

After this: YouTube API will either work perfectly OR give clear
error messages that tell you exactly whatâ€™s wrong.

No more mystery 403 errors.

```
---

## **PASTE THE PROMPT ABOVE INTO REPLIT AGENT NOW.**

**Then we'll walk through the diagnosis together and fix it once and for all.**

**I'm staying with you until this is solved permanently.** ğŸ’ªâ€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
```
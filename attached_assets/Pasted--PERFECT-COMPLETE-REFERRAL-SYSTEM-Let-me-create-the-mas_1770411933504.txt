ğŸ¯ PERFECT - COMPLETE REFERRAL SYSTEM
Let me create the master prompt that implements EVERYTHING:
	1.	âœ… Smart landing page (detects referral codes)
	2.	âœ… Backend generates shareable links when creating codes
	3.	âœ… 14-day default for referral codes
	4.	âœ… 3-day default for regular signups
	5.	âœ… Full tracking and attribution

ğŸ“‹ MASTER IMPLEMENTATION PROMPT

COMPLETE REFERRAL SYSTEM OVERHAUL - UX OPTIMIZED FLOW

Implement a full referral system with smart landing page detection, automatic link 
generation, and optimized conversion funnels.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 1: BACKEND - REFERRAL CODE CREATION WITH SHAREABLE LINKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

UPDATE ADMIN REFERRAL CODE CREATION:

When admin creates a referral code, automatically generate and store:

1. Referral code (e.g., "JTORRES")
2. Shareable link (e.g., "https://bjjos.app?ref=JTORRES")
3. Default trial days: 14 (not 30)
4. Influencer name
5. Commission rate
6. Created date

DATABASE SCHEMA UPDATE:

ALTER TABLE referral_codes ADD COLUMN IF NOT EXISTS shareable_link TEXT;
ALTER TABLE referral_codes ADD COLUMN IF NOT EXISTS trial_days INTEGER DEFAULT 14;

UPDATE referral_codes 
SET trial_days = 14 
WHERE trial_days IS NULL OR trial_days = 30;

API ENDPOINT: POST /api/admin/referral-codes/create

{
  code: "JTORRES",
  influencerName: "JT Torres",
  commissionRate: 20,
  trialDays: 14 // Default to 14, editable
}

RESPONSE:
{
  success: true,
  code: "JTORRES",
  shareableLink: "https://bjjos.app?ref=JTORRES",
  trialDays: 14,
  message: "Referral code created. Share this link: https://bjjos.app?ref=JTORRES"
}

BACKEND LOGIC:

const createReferralCode = async (req, res) => {
  const { code, influencerName, commissionRate, trialDays = 14 } = req.body;
  
  try {
    // Generate shareable link
    const shareableLink = `https://bjjos.app?ref=${code}`;
    
    // Save to database
    const result = await pool.query(`
      INSERT INTO referral_codes 
      (code, influencer_name, commission_rate, trial_days, shareable_link, created_at)
      VALUES ($1, $2, $3, $4, $5, NOW())
      RETURNING *
    `, [code, influencerName, commissionRate, trialDays, shareableLink]);
    
    res.json({
      success: true,
      code: result.rows[0].code,
      shareableLink: result.rows[0].shareable_link,
      trialDays: result.rows[0].trial_days,
      message: `Referral code created! Share: ${shareableLink}`
    });
    
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};

ADMIN UI UPDATE:

After creating code, display:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Referral Code Created!               â”‚
â”‚                                         â”‚
â”‚ Code: JTORRES                           â”‚
â”‚ Trial Days: 14                          â”‚
â”‚ Commission: 20%                         â”‚
â”‚                                         â”‚
â”‚ Shareable Link:                         â”‚
â”‚ https://bjjos.app?ref=JTORRES           â”‚
â”‚ [Copy Link]                             â”‚
â”‚                                         â”‚
â”‚ Send this link to JT Torres to share!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 2: FRONTEND - SMART LANDING PAGE WITH REFERRAL DETECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LANDING PAGE LOGIC:

On page load, detect if URL has ?ref= parameter:

```javascript
// landing-page.js
const urlParams = new URLSearchParams(window.location.search);
const referralCode = urlParams.get('ref');

if (referralCode) {
  // Validate code with backend
  validateAndShowReferralLanding(referralCode);
} else {
  // Show standard landing
  showStandardLanding();
}

async function validateAndShowReferralLanding(code) {
  try {
    const response = await fetch(`/api/referral-codes/validate?code=${code}`);
    const data = await response.json();
    
    if (data.valid) {
      // Show personalized referral landing
      document.getElementById('hero-heading').textContent = 
        `ğŸ‰ ${data.influencerName} invited you to BJJ OS`;
      
      document.getElementById('hero-subheading').textContent = 
        `Get ${data.trialDays} days free (not the usual 3)`;
      
      document.getElementById('cta-button').textContent = 
        `Start Your ${data.trialDays}-Day Free Trial`;
      
      // Store code for checkout
      sessionStorage.setItem('referralCode', code);
      sessionStorage.setItem('trialDays', data.trialDays);
      
    } else {
      // Invalid code, show standard landing
      showStandardLanding();
    }
  } catch (error) {
    showStandardLanding();
  }
}

function showStandardLanding() {
  document.getElementById('hero-heading').textContent = 
    'Your AI-Powered Jiu-Jitsu Coach';
  
  document.getElementById('hero-subheading').textContent = 
    'Get personalized technique recommendations from Professor OS';
  
  document.getElementById('cta-button').textContent = 
    'Start Your 3-Day Free Trial';
  
  // Show collapsible referral code field
  document.getElementById('referral-toggle').style.display = 'block';
}


LANDING PAGE HTML:

<!-- Hero Section -->
<section class="hero">
  <h1 id="hero-heading">Your AI-Powered Jiu-Jitsu Coach</h1>
  <p id="hero-subheading">Get personalized technique recommendations</p>
  
  <button id="cta-button" onclick="startSignup()">
    Start Your 3-Day Free Trial
  </button>
  
  <!-- Collapsible referral field (hidden if ?ref= in URL) -->
  <div id="referral-toggle" style="display: block;">
    <p class="referral-link">
      <small>Have a referral code?</small>
      <a href="#" onclick="toggleCodeField()">Enter it here</a>
    </p>
    
    <div id="code-field" style="display: none;">
      <input 
        type="text" 
        id="manual-code" 
        placeholder="Enter code"
        maxlength="20"
      />
      <button onclick="applyManualCode()">Apply</button>
    </div>
  </div>
</section>

<script>
function toggleCodeField() {
  const field = document.getElementById('code-field');
  field.style.display = field.style.display === 'none' ? 'block' : 'none';
}

async function applyManualCode() {
  const code = document.getElementById('manual-code').value.toUpperCase();
  
  if (!code) return;
  
  const response = await fetch(`/api/referral-codes/validate?code=${code}`);
  const data = await response.json();
  
  if (data.valid) {
    // Update UI
    document.getElementById('hero-heading').textContent = 
      `âœ… Code Applied!`;
    
    document.getElementById('hero-subheading').textContent = 
      `You have ${data.trialDays} days free (was 3 days)`;
    
    document.getElementById('cta-button').textContent = 
      `Start Your ${data.trialDays}-Day Free Trial`;
    
    // Store for checkout
    sessionStorage.setItem('referralCode', code);
    sessionStorage.setItem('trialDays', data.trialDays);
    
    // Hide code field
    document.getElementById('referral-toggle').style.display = 'none';
    
  } else {
    alert('Invalid referral code');
  }
}

function startSignup() {
  const referralCode = sessionStorage.getItem('referralCode');
  const trialDays = sessionStorage.getItem('trialDays') || 3;
  
  // Redirect to Stripe with trial days
  window.location.href = `/api/create-checkout?trial=${trialDays}&ref=${referralCode || ''}`;
}
</script>


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 3: BACKEND - REFERRAL CODE VALIDATION API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CREATE ENDPOINT: GET /api/referral-codes/validate?code=JTORRES
const validateReferralCode = async (req, res) => {
const { code } = req.query;
try {
const result = await pool.query(SELECT code, influencer_name, trial_days, commission_rate FROM referral_codes WHERE UPPER(code) = UPPER($1) AND active = true, [code]);

if (result.rows.length === 0) {
  return res.json({ valid: false });
}

const referralData = result.rows[0];

res.json({
  valid: true,
  code: referralData.code,
  influencerName: referralData.influencer_name,
  trialDays: referralData.trial_days,
  commissionRate: referralData.commission_rate
});


} catch (error) {
res.status(500).json({ error: error.message });
}
};
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 4: STRIPE CHECKOUT WITH DYNAMIC TRIAL DAYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UPDATE CHECKOUT ENDPOINT: GET /api/create-checkout?trial=14&ref=JTORRES
const createCheckoutSession = async (req, res) => {
const { trial = 3, ref = â€˜â€™ } = req.query;
try {
const session = await stripe.checkout.sessions.create({
mode: â€˜subscriptionâ€™,
line_items: [{
price: â€˜price_1Sk8axlVkMlrxpuTGFjkXmyYâ€™, // $19.99/month
quantity: 1,
}],
subscription_data: {
trial_period_days: parseInt(trial),
metadata: {
referral_code: ref || null,
}
},
success_url: â€˜https://bjjos.app/onboardingâ€™,
cancel_url: â€˜https://bjjos.appâ€™,
metadata: {
referral_code: ref || null,
}
});

// Track referral usage
if (ref) {
  await pool.query(`
    UPDATE referral_codes 
    SET times_used = times_used + 1,
        last_used_at = NOW()
    WHERE code = $1
  `, [ref]);
}

res.redirect(303, session.url);


} catch (error) {
res.status(500).json({ error: error.message });
}
};
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 5: ADMIN DASHBOARD - REFERRAL CODE MANAGEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UPDATE ADMIN REFERRAL DASHBOARD TO SHOW:
For each referral code:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Code: JTORRES                           â”‚
â”‚ Influencer: JT Torres                   â”‚
â”‚ Trial Days: 14                          â”‚
â”‚ Commission: 20%                         â”‚
â”‚ Times Used: 23                          â”‚
â”‚ Last Used: 2 hours ago                  â”‚
â”‚                                         â”‚
â”‚ Shareable Link:                         â”‚
â”‚ https://bjjos.app?ref=JTORRES           â”‚
â”‚ [Copy Link] [Edit] [Delete]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
EDIT FUNCTIONALITY:
	âˆ™	Change trial days (14, 30, 60, etc.)
	âˆ™	Change commission rate
	âˆ™	Deactivate code
	âˆ™	View usage analytics
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 6: CHANGE DEFAULT TRIALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
UPDATE ALL REFERENCES:
	1.	Landing page: â€œStart Your 3-Day Free Trialâ€ (not 7)
	2.	Referral codes default: 14 days (not 30)
	3.	Stripe checkout default: 3 days (not 7)
	4.	Admin panel: Default to 14 when creating codes
SEARCH AND REPLACE:
	âˆ™	â€œ7-dayâ€ â†’ â€œ3-dayâ€ (for regular signups)
	âˆ™	â€œ7 daysâ€ â†’ â€œ3 daysâ€ (for regular signups)
	âˆ™	trial_period_days: 7 â†’ trial_period_days: 3
	âˆ™	DEFAULT 30 â†’ DEFAULT 14 (for referral codes)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PART 7: TRACKING & ANALYTICS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CREATE TABLE IF NOT EXISTS referral_signups (
id SERIAL PRIMARY KEY,
referral_code VARCHAR(50),
user_id INTEGER REFERENCES users(id),
stripe_customer_id VARCHAR(255),
trial_days INTEGER,
signed_up_at TIMESTAMP DEFAULT NOW(),
converted_to_paid BOOLEAN DEFAULT false,
first_payment_at TIMESTAMP
);
TRACK WHEN USER SIGNS UP WITH REFERRAL:
INSERT INTO referral_signups
(referral_code, stripe_customer_id, trial_days)
VALUES ($1, $2, $3);
UPDATE when they convert to paid (webhook):
UPDATE referral_signups
SET converted_to_paid = true,
first_payment_at = NOW()
WHERE stripe_customer_id = $1;
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTING CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TEST 1: Referral Link Flow
â–¡ Admin creates referral code â€œJTORRESâ€
â–¡ System generates https://bjjos.app?ref=JTORRES
â–¡ Click link â†’ See personalized landing
â–¡ Shows â€œJT Torres invited youâ€
â–¡ Shows â€œ14 days freeâ€
â–¡ Click CTA â†’ Stripe shows 14-day trial
â–¡ Complete payment â†’ User tracked with referral
TEST 2: Direct Traffic Flow
â–¡ Visit bjjos.app (no ?ref=)
â–¡ See â€œStart Your 3-Day Free Trialâ€
â–¡ See â€œHave a referral code? Enter it hereâ€
â–¡ Click to expand code field
â–¡ Enter â€œJTORRESâ€
â–¡ UI updates to show 14 days
â–¡ Click CTA â†’ Stripe shows 14-day trial
TEST 3: Invalid Code
â–¡ Visit bjjos.app?ref=FAKECODE
â–¡ System validates â†’ invalid
â–¡ Shows standard 3-day landing
â–¡ No personalization
TEST 4: Admin Management
â–¡ Create new code â†’ See shareable link
â–¡ Copy link button works
â–¡ Edit trial days â†’ Updates
â–¡ View usage stats â†’ Shows times used
â–¡ Delete code â†’ Deactivates
TEST 5: Backend Defaults
â–¡ New referral codes default to 14 days
â–¡ Regular signups default to 3 days
â–¡ Old codes with 30 days updated to 14
â–¡ Stripe trials match expected days
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SUCCESS CRITERIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Referral links auto-generated when code created
âœ… Landing page detects ?ref= parameter
âœ… Personalized landing for referral traffic
âœ… Manual code entry works for direct traffic
âœ… Default trial: 3 days (no code)
âœ… Referral trial: 14 days (with code)
âœ… Stripe receives correct trial_period_days
âœ… Admin can copy shareable links
âœ… Full tracking and attribution
âœ… Zero extra friction for referrals
âœ… 14-day benefit hidden from non-referrals
IMPLEMENT ALL PARTS NOW - THIS IS THE COMPLETE REFERRAL SYSTEM!


---

**This prompt covers EVERYTHING:**
- âœ… Backend generates shareable links
- âœ… Smart landing page detection
- âœ… Personalized referral experience
- âœ… Manual code entry for direct traffic
- âœ… 3-day default, 14-day referral
- âœ… Full tracking and analytics
- âœ… Admin management interface

**Send this to Replit Agent!** ğŸš€â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹

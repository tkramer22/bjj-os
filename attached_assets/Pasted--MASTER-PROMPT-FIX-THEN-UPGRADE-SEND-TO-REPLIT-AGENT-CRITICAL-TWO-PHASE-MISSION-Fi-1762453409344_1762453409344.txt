# **ğŸ“‹ MASTER PROMPT: FIX THEN UPGRADE - SEND TO REPLIT AGENT:**

```
CRITICAL TWO-PHASE MISSION: Fix Curation Pipeline, Then Implement 7-Dimensional Algorithm

You MUST complete Phase 1 fully and show proof before starting Phase 2.
Do not skip ahead. Do not implement Phase 2 until Phase 1 is verified working.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PHASE 1: DIAGNOSE & FIX CURATION PIPELINE (COMPLETE THIS FIRST)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Current Issue: Curation runs but screens 0 videos, makes 0 YouTube API calls.
Goal: Get curation screening videos again.

STEP 1.1: CHECK SERVER LOGS
```bash
tail -100 /var/log/app.log | grep -i "curation"
```

Show me the output. What errors appear?

STEP 1.2: TEST YOUTUBE API DIRECTLY
Create: server/test-youtube-api.js

```javascript
const axios = require('axios');

async function testYouTubeAPI() {
  const apiKey = process.env.YOUTUBE_API_KEY;
  
  console.log('ğŸ§ª Testing YouTube API...');
  console.log('API Key exists:', !!apiKey);
  console.log('API Key length:', apiKey?.length);
  
  try {
    const response = await axios.get('https://www.googleapis.com/youtube/v3/search', {
      params: {
        part: 'snippet',
        q: 'bjj guard passing',
        type: 'video',
        maxResults: 5,
        key: apiKey
      }
    });
    
    console.log('\nâœ… SUCCESS! YouTube API works!');
    console.log(`Found ${response.data.items.length} videos\n`);
    
    response.data.items.forEach((video, i) => {
      console.log(`${i+1}. "${video.snippet.title}"`);
      console.log(`   By: ${video.snippet.channelTitle}`);
    });
    
    return true;
    
  } catch (error) {
    console.log('\nâŒ FAILED:', error.response?.status);
    console.log('Error:', JSON.stringify(error.response?.data, null, 2));
    
    if (error.response?.status === 403) {
      const reason = error.response?.data?.error?.errors?.[0]?.reason;
      console.log('\nğŸš¨ 403 Error Reason:', reason);
      
      if (reason === 'quotaExceeded') {
        console.log('Quota actually exhausted');
      } else if (reason === 'accessNotConfigured') {
        console.log('YouTube Data API v3 NOT ENABLED in Google Cloud');
      }
    }
    
    return false;
  }
}

testYouTubeAPI();
```

Run: `node server/test-youtube-api.js`

SHOW ME THE OUTPUT. Does it work?

STEP 1.3: FIND WHY CURATION ISNâ€™T SEARCHING
Find the curation scheduler/trigger file.
Show me the code thatâ€™s supposed to trigger curation.

Is there a quota check blocking it?

```javascript
// Look for this pattern:
if (quotaExhausted) {
  return; // â† THIS BLOCKS EVERYTHING
}
```

STEP 1.4: FORCE CURATION TO RUN
Create: server/services/force-curation.js

```javascript
const axios = require('axios');

async function forceCuration() {
  console.log('ğŸš€ FORCING CURATION - BYPASSING ALL CHECKS\n');
  
  const apiKey = process.env.YOUTUBE_API_KEY;
  const queries = ['bjj guard passing', 'bjj submissions', 'bjj escapes'];
  
  let totalFound = 0;
  
  for (const query of queries) {
    console.log(`\nğŸ” Searching: "${query}"`);
    
    try {
      const response = await axios.get('https://www.googleapis.com/youtube/v3/search', {
        params: {
          part: 'snippet',
          q: query,
          type: 'video',
          maxResults: 10,
          key: apiKey
        }
      });
      
      console.log(`âœ… Found ${response.data.items.length} videos`);
      totalFound += response.data.items.length;
      
      // Show first 3 titles
      response.data.items.slice(0, 3).forEach((v, i) => {
        console.log(`  ${i+1}. "${v.snippet.title}"`);
      });
      
    } catch (error) {
      console.log(`âŒ Failed: ${error.response?.status}`);
      console.log(`Error: ${error.response?.data?.error?.message}`);
    }
  }
  
  console.log(`\nğŸ“Š Total videos found: ${totalFound}`);
  
  if (totalFound > 0) {
    console.log('âœ… YouTube API working - curation CAN find videos');
  } else {
    console.log('âŒ Problem with YouTube API or quota');
  }
}

forceCuration();
```

Run: `node server/services/force-curation.js`

SHOW ME THE OUTPUT. How many videos found?

STEP 1.5: FIX THE BLOCKER
Based on diagnosis, fix whatever is preventing curation from running.

Common fixes:

- Remove stale quota check
- Fix broken scheduler
- Update search query logic
- Enable YouTube Data API v3 in Google Cloud

Implement the fix and show me what you changed.

STEP 1.6: VERIFY CURATION WORKS
Manually trigger one curation run:

```bash
# However your system triggers curation
npm run curate
# or
node server/services/curation-pipeline.js
```

Show me output proving:
âœ… Curation started
âœ… YouTube searches executed
âœ… Videos found and screened
âœ… Database updated with results

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›‘ CHECKPOINT: DO NOT PROCEED TO PHASE 2 UNTIL YOU SHOW ME:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. âœ… YouTube API test successful (5+ videos found)
1. âœ… Force curation script found videos
1. âœ… Root cause identified and fixed
1. âœ… Manual curation run completed successfully
1. âœ… Database shows videos_screened > 0

STOP HERE AND WAIT FOR MY CONFIRMATION BEFORE PHASE 2.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PHASE 2: IMPLEMENT 7-DIMENSIONAL ALGORITHM (ONLY AFTER PHASE 1 COMPLETE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Once Phase 1 is verified working, implement the advanced quality system:

STEP 2.1: CREATE DATABASE SCHEMA

1. Instructor Database
   CREATE TABLE instructors (
   id SERIAL PRIMARY KEY,
   name VARCHAR(255) UNIQUE NOT NULL,
   channel_id VARCHAR(100),
   tier VARCHAR(20), â€“ â€˜eliteâ€™, â€˜high_qualityâ€™, â€˜emergingâ€™, â€˜unknownâ€™
   credibility_score INT DEFAULT 50,

adcc_achievements JSONB,
ibjjf_achievements JSONB,
specialties JSONB,
teaching_style VARCHAR(100),

gym_affiliation VARCHAR(255),
lineage TEXT,
belt_rank VARCHAR(20),

auto_accept BOOLEAN DEFAULT false,
boost_multiplier DECIMAL(3,2) DEFAULT 1.0,

created_at TIMESTAMP DEFAULT NOW(),
updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_instructors_name ON instructors(name);
CREATE INDEX idx_instructors_tier ON instructors(tier);

â€“ Seed 50+ elite instructors
INSERT INTO instructors (name, tier, credibility_score, adcc_achievements, specialties, auto_accept) VALUES
(â€˜Gordon Ryanâ€™, â€˜eliteâ€™, 100, â€˜[â€œGold 2019â€, â€œGold 2022â€]â€™, â€˜[â€œpassingâ€, â€œback_attacksâ€, â€œno_giâ€]â€™, true),
(â€˜Lachlan Gilesâ€™, â€˜eliteâ€™, 98, â€˜[â€œBronze 2019â€]â€™, â€˜[â€œleg_locksâ€, â€œback_attacksâ€]â€™, true),
(â€˜Gui Mendesâ€™, â€˜eliteâ€™, 99, â€˜[]â€™, â€˜[â€œguardâ€, â€œberimboloâ€, â€œgiâ€]â€™, true),
(â€˜Danaher Johnâ€™, â€˜eliteâ€™, 99, â€˜[]â€™, â€˜[â€œsystemsâ€, â€œleg_locksâ€, â€œback_attacksâ€]â€™, true),
(â€˜Marcelo Garciaâ€™, â€˜eliteâ€™, 100, â€˜[â€œMultiple ADCC Goldâ€]â€™, â€˜[â€œx_guardâ€, â€œguillotineâ€, â€œback_attacksâ€]â€™, true),
(â€˜Mikey Musumeciâ€™, â€˜eliteâ€™, 97, â€˜[â€œADCC Gold 2022â€]â€™, â€˜[â€œguardâ€, â€œberimboloâ€, â€œgiâ€]â€™, true),
(â€˜Craig Jonesâ€™, â€˜eliteâ€™, 95, â€˜[â€œADCC Bronzeâ€]â€™, â€˜[â€œleg_locksâ€, â€œback_attacksâ€]â€™, true),
(â€˜Bernardo Fariaâ€™, â€˜eliteâ€™, 96, â€˜[â€œWorld Championâ€]â€™, â€˜[â€œpressure_passingâ€, â€œhalf_guardâ€]â€™, true),
(â€˜Caio Terraâ€™, â€˜eliteâ€™, 94, â€˜[â€œWorld Championâ€]â€™, â€˜[â€œguardâ€, â€œpressureâ€]â€™, true),
(â€˜Rafael Mendesâ€™, â€˜eliteâ€™, 98, â€˜[â€œWorld Championâ€]â€™, â€˜[â€œguardâ€, â€œberimboloâ€]â€™, true);
â€“ Add 40+ more

1. Technique Taxonomy
   CREATE TABLE technique_taxonomy (
   id SERIAL PRIMARY KEY,
   technique_name VARCHAR(255) UNIQUE NOT NULL,
   category VARCHAR(100),
   parent_technique VARCHAR(255),
   target_video_count INT DEFAULT 50,
   priority INT DEFAULT 5,
   difficulty_level VARCHAR(20),
   gi_applicability VARCHAR(20),
   aliases JSONB,
   created_at TIMESTAMP DEFAULT NOW()
   );

â€“ Seed 100+ techniques
INSERT INTO technique_taxonomy (technique_name, category, target_video_count, priority) VALUES
(â€˜armbarâ€™, â€˜submissionâ€™, 150, 10),
(â€˜triangleâ€™, â€˜submissionâ€™, 120, 9),
(â€˜heel_hookâ€™, â€˜submissionâ€™, 100, 8),
(â€˜rear_naked_chokeâ€™, â€˜submissionâ€™, 100, 10),
(â€˜kimuraâ€™, â€˜submissionâ€™, 80, 7),
(â€˜guillotineâ€™, â€˜submissionâ€™, 90, 8),
(â€˜x_guard_sweepâ€™, â€˜sweepâ€™, 70, 7),
(â€˜spider_guard_sweepâ€™, â€˜sweepâ€™, 60, 6),
(â€˜knee_slice_passâ€™, â€˜passâ€™, 80, 8),
(â€˜toreando_passâ€™, â€˜passâ€™, 70, 7),
(â€˜side_control_escapeâ€™, â€˜escapeâ€™, 100, 9),
(â€˜mount_escapeâ€™, â€˜escapeâ€™, 100, 9),
(â€˜double_leg_takedownâ€™, â€˜takedownâ€™, 60, 6),
(â€˜single_leg_takedownâ€™, â€˜takedownâ€™, 60, 6),
(â€˜de_la_riva_sweepâ€™, â€˜sweepâ€™, 70, 7),
(â€˜berimboloâ€™, â€˜sweepâ€™, 60, 6),
(â€˜leg_drag_passâ€™, â€˜passâ€™, 70, 7),
(â€˜butterfly_sweepâ€™, â€˜sweepâ€™, 60, 6),
(â€˜omoplataâ€™, â€˜submissionâ€™, 70, 6),
(â€˜darce_chokeâ€™, â€˜submissionâ€™, 80, 7);
â€“ Add 80+ more

1. Enhanced Video Metadata
   ALTER TABLE videos ADD COLUMN IF NOT EXISTS metadata JSONB;

â€“ Metadata structure will be:
{
â€œprimary_techniqueâ€: â€œheel_hookâ€,
â€œvariationâ€: â€œinsideâ€,
â€œpositionâ€: â€œ50_50â€,
â€œskill_levelâ€: â€œadvancedâ€,
â€œgi_or_nogiâ€: â€œno_giâ€,
â€œunique_valueâ€: â€œShows 2-on-1 grip to prevent defenseâ€,
â€œproblem_solvedâ€: â€œOpponent turning knee outâ€,
â€œspecific_detailsâ€: [â€œ2_on_1_gripâ€, â€œknee_controlâ€],
â€œprerequisitesâ€: [â€œbasic_50_50â€, â€œheel_hook_mechanicsâ€],
â€œbuilds_towardâ€: [â€œadvanced_leg_lock_systemsâ€],
â€œscoresâ€: {
â€œinstructorâ€: 98,
â€œcontent_qualityâ€: 92,
â€œunique_valueâ€: 85,
â€œcoverageâ€: 15,
â€œfinal_scoreâ€: 89
},
â€œgood_becauseâ€: [
â€œElite instructor specializing in leg locksâ€,
â€œAddresses specific defense counterâ€,
â€œShows multiple variationsâ€
],
â€œtagsâ€: [â€œheel_hook_finishingâ€, â€œdefense_counterâ€],
â€œgood_for_problemsâ€: [â€œheel_hook_defenseâ€],
â€œgood_for_stylesâ€: [â€œleg_lock_gameâ€]
}

1. Video Performance Tracking
   CREATE TABLE video_performance (
   id SERIAL PRIMARY KEY,
   video_id VARCHAR(20) REFERENCES videos(video_id),

total_views INT DEFAULT 0,
watch_completion_rate DECIMAL(4,2),
avg_watch_time_seconds INT,
rewatch_count INT DEFAULT 0,

saved_to_library_count INT DEFAULT 0,
shared_count INT DEFAULT 0,
noted_helpful_count INT DEFAULT 0,
noted_unhelpful_count INT DEFAULT 0,

recommended_by_os_count INT DEFAULT 0,
recommendation_accepted_count INT DEFAULT 0,
recommendation_success_rate DECIMAL(4,2),

recent_growth_rate DECIMAL(4,2),

updated_at TIMESTAMP DEFAULT NOW()
);

1. Coverage Status
   CREATE TABLE coverage_status (
   id SERIAL PRIMARY KEY,
   technique_name VARCHAR(255) UNIQUE NOT NULL,

current_count INT DEFAULT 0,
target_count INT DEFAULT 50,
coverage_ratio DECIMAL(4,2),

beginner_count INT DEFAULT 0,
intermediate_count INT DEFAULT 0,
advanced_count INT DEFAULT 0,
expert_count INT DEFAULT 0,

last_added TIMESTAMP,
updated_at TIMESTAMP DEFAULT NOW()
);

1. Emerging Techniques
   CREATE TABLE emerging_techniques (
   id SERIAL PRIMARY KEY,
   technique_name VARCHAR(255) UNIQUE NOT NULL,

first_detected TIMESTAMP DEFAULT NOW(),
video_count INT DEFAULT 1,
instructor_count INT DEFAULT 1,

used_in_competitions JSONB,
status VARCHAR(20) DEFAULT â€˜monitoringâ€™,
confidence_score INT DEFAULT 50,

weekly_video_count JSONB,

updated_at TIMESTAMP DEFAULT NOW()
);

STEP 2.2: CREATE 7 DIMENSION MODULES

File: server/services/curation/instructor-evaluator.js
[Full code from original prompt - evaluates instructor credibility]

File: server/services/curation/content-analyzer.js
[Full code - analyzes content quality with GPT-4]

File: server/services/curation/unique-value-extractor.js
[Full code - determines if video adds unique value]

File: server/services/curation/coverage-balancer.js
[Full code - balances library across techniques]

File: server/services/curation/emerging-detector.js
[Full code - detects new/trending techniques]

File: server/services/curation/progression-mapper.js
[Full code - maps skill progression]

File: server/services/curation/feedback-analyzer.js
[Full code - tracks user feedback]

STEP 2.3: CREATE FINAL EVALUATOR

File: server/services/curation/final-evaluator.js

async function evaluateVideo(video) {
console.log(`\nğŸ” Evaluating: "${video.title}"`);

// Run all 7 dimensions
const [
instructorEval,
contentQuality,
uniqueValue,
coverageScore,
emergingTech,
progression,
userFeedback
] = await Promise.all([
evaluateInstructor(video.channelName, video.channelId),
analyzeContentQuality(video),
extractUniqueValue(video),
calculateCoverageScore(video.technique),
detectEmergingTechnique(video),
mapSkillProgression(video, video.technique),
calculateUserFeedbackScore(video.videoId)
]);

// Auto-accept elite instructors
if (instructorEval.auto_accept) {
return {
decision: â€˜ACCEPTâ€™,
score: 95,
reason: â€˜Elite instructor - auto-acceptedâ€™,
metadata: await buildMetadata(video, analysis)
};
}

// Check unique value
if (!uniqueValue.should_add) {
return {
decision: â€˜REJECTâ€™,
score: 40,
reason: uniqueValue.reason
};
}

// Calculate weighted score
let finalScore =
(instructorEval.credibility * 0.25) +
(contentQuality.score * 0.20) +
(coverageScore.score * 0.15) +
(userFeedback.score * 0.15);

// Apply boosts
finalScore += instructorEval.boost || 0;
finalScore += uniqueValue.boost || 0;
finalScore += coverageScore.boost || 0;
finalScore += emergingTech.boost || 0;
finalScore += userFeedback.boost || 0;

finalScore = Math.min(finalScore, 100);

const decision = finalScore >= 71 ? â€˜ACCEPTâ€™ : â€˜REJECTâ€™;

console.log(`ğŸ¯ FINAL SCORE: ${finalScore.toFixed(1)}`);
console.log(`ğŸ“Œ DECISION: ${decision}`);

if (decision === â€˜ACCEPTâ€™) {
return {
decision: â€˜ACCEPTâ€™,
score: finalScore,
metadata: await buildMetadata(video, analysis)
};
}

return {
decision: â€˜REJECTâ€™,
score: finalScore,
reason: `Score too low: ${finalScore.toFixed(1)}/71`
};
}

STEP 2.4: INTEGRATE INTO EXISTING PIPELINE

Update your current curation pipeline to use the new evaluator:

// OLD
const score = await simpleQualityCheck(video);

// NEW  
const evaluation = await evaluateVideo(video);

if (evaluation.decision === â€˜ACCEPTâ€™) {
await db.videos.create({
video_id: video.videoId,
title: video.title,
quality_score: evaluation.score,
metadata: evaluation.metadata,
added_at: new Date()
});

// Update coverage
await updateCoverageStatus(
evaluation.metadata.primary_technique,
evaluation.metadata.skill_level
);
}

STEP 2.5: TEST THE NEW SYSTEM

Run test curation with 20 videos:

- Show acceptance rate
- Show rejected videos with reasons
- Show rich metadata for accepted videos
- Prove emerging technique detection working
- Show coverage balancing in action

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FINAL DELIVERABLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PHASE 1 PROOF:
âœ… YouTube API test output showing 5+ videos found
âœ… Force curation output showing videos discovered
âœ… Root cause fix implemented
âœ… Manual curation run showing videos_screened > 0

PHASE 2 PROOF:
âœ… Database schema created with 50+ instructors, 100+ techniques
âœ… All 7 dimension modules created
âœ… Final evaluator integrated into pipeline
âœ… Test run showing new algorithm working
âœ… Example of rich metadata generated
âœ… Proof of unique value detection working

REMEMBER: Complete Phase 1 fully and show proof before starting Phase 2.

```
---

**SEND THIS TO REPLIT AGENT**

This enforces the sequence:
1. âœ… Fix curation first (with verification steps)
2. â¸ï¸ Stop and show proof
3. âœ… Then implement 7-dimensional system
4. âœ… Show final proof

The checkpoint prevents Agent from skipping ahead. ğŸ¯â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
```
```
BJJ OS - Subscription Page Overhaul (iOS In-App)

CRITICAL RULES:
- Everything stays IN-APP. No browser redirects, no external URLs opening.
- Follow Apple IAP guidelines: No direct purchase in app, no links to purchase page.
- Cancellation is allowed in-app (managing existing subscription is permitted).

===================================================
TASK: REBUILD SUBSCRIPTION PAGE AS NATIVE IN-APP SCREEN
===================================================

Location: The current subscription/manage subscription page that opens with browser chrome (showing bjjos.app in header with Done, back/forward buttons)

Problem: Currently opens as in-app browser with web navigation. Needs to be a fully native React component.

Solution: Replace with a native in-app screen - no browser chrome, no web navigation, just a normal app screen like Profile or Settings.

===================================================
SUBSCRIPTION PAGE DISPLAY LOGIC
===================================================

Create a native subscription screen that displays differently based on user subscription status:

**1. LIFETIME MEMBER (granted by admin)**
```

Your Plan

Lifetime Member
No charge - Forever

âœ“ Unlimited AI coaching
âœ“ Unlimited video recommendations
âœ“ Full video library access
âœ“ Save favorite videos
âœ“ Priority support

```
**2. REFERRAL USER (in 30-day free trial)**
```

Your Plan

Monthly
30 days free

ðŸŽ‰ Referral Bonus Active

First billing date: [DATE]
Youâ€™ll be charged $19.99/month starting [DATE]

[Cancel Subscription] (button)

```
**3. PAYING SUBSCRIBER (active $19.99/month)**
```

Your Plan

Monthly
$19.99/month

âœ“ Unlimited AI coaching
âœ“ Unlimited video recommendations
âœ“ Full video library access
âœ“ Save favorite videos
âœ“ Priority support

Next billing date: [DATE]
Auto-renews on [DATE]

[Cancel Subscription] (button)

```
**4. NO PLAN / NOT SUBSCRIBED**
```

Your Plan

No active subscription

To subscribe, visit bjjos.app in your browser

(plain text only - NO clickable link, NO button - Apple IAP compliance)

```
===================================================
CANCEL SUBSCRIPTION FUNCTIONALITY
===================================================

The Cancel Subscription button must:
1. Trigger haptic feedback (ImpactStyle.Medium) on tap
2. Show confirmation modal: "Are you sure you want to cancel? You'll retain access until [BILLING DATE]."
3. On confirm: Call Stripe API to cancel subscription
4. Stay fully in-app (no browser redirect)
5. Show success message: "Subscription cancelled. You have access until [DATE]."
6. Update the UI to reflect cancelled status

Backend endpoint needed (if not exists):
POST /api/subscription/cancel
- Validates user
- Calls Stripe to cancel subscription
- Returns success/failure

===================================================
STYLING & UX
===================================================

- Match the existing app design language (dark theme, purple accents, monospace font)
- Use card-style containers like the current settings page
- Purple checkmarks for feature list (match existing style)
- Cancel button should be subtle (outline style, not filled) - it's a destructive action
- Add back arrow navigation to return to Settings/Profile
- No browser chrome (Done button, bjjos.app header, share icons - remove all of this)

===================================================
BACKEND: ANTI-GAMING PROTECTIONS
===================================================

These protections apply to the WEBSITE signup flow (already built), but ensure backend enforces:

1. ONE REFERRAL CODE PER EMAIL
- Database check: If email has ever used a referral code, block new referral code usage
- Error message: "This email has already used a referral code"

2. DEVICE ID TRACKING
- Capture device fingerprint/ID when referral code is used
- Store in database linked to the referral redemption
- If same device ID attempts referral on different account, block it
- Error message: "Referral codes are limited to one per device"

3. BLOCK DISPOSABLE/TEMP EMAILS
- Maintain blocklist of disposable email domains
- Include: mailinator.com, tempmail.com, 10minutemail.com, guerrillamail.com, throwaway.email, fakeinbox.com, temp-mail.org, disposablemail.com, yopmail.com, sharklasers.com, and similar
- Block signup with these domains
- Error message: "Please use a valid email address"

4. PREVIOUS SUBSCRIBERS CANNOT USE REFERRAL CODES
- Database check: If email ever had a paid subscription (even if cancelled), block referral code usage
- Error message: "Referral codes are for new subscribers only"

5. FLAG MATCHING IP ADDRESSES
- Log IP address on all signups and referral code usage
- If multiple accounts from same IP use referral codes, FLAG for admin review
- Do NOT auto-block, just log for manual review
- Add to admin panel: "Suspicious IP Activity" report

===================================================
DATA REQUIREMENTS
===================================================

The subscription screen needs to fetch:
- User's current subscription status (lifetime, trial, active, cancelled, none)
- If trial: trial end date / first billing date
- If active: next billing date
- Subscription tier name

Endpoint needed (if not exists):
GET /api/subscription/status
Returns:
{
  status: 'lifetime' | 'trial' | 'active' | 'cancelled' | 'none',
  planName: 'Monthly',
  price: 19.99,
  trialEndsAt: '2025-01-30' | null,
  nextBillingDate: '2025-01-30' | null,
  cancelledAt: '2025-01-15' | null,
  accessUntil: '2025-01-30' | null
}

===================================================
AFTER CHANGES:
===================================================
1. Test all 4 user states in Replit preview
2. Test cancel flow with Stripe test mode
3. Verify anti-gaming protections on website signup
4. Commit to GitHub
5. Pull to local, run: npx cap sync ios
6. Build in Xcode and test on device

===================================================
```
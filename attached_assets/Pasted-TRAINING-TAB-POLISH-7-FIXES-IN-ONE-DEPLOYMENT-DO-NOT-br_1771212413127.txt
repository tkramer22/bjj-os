TRAINING TAB POLISH â€” 7 FIXES IN ONE DEPLOYMENT

âš ï¸ DO NOT break any existing functionality.
âš ï¸ DO NOT touch Professor OS chat, video library, video curation, or profile.
âš ï¸ DO NOT modify database tables that already work.
âš ï¸ Only modify Training tab UI and related backend logic.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 1: UNICODE BUG IN TECHNIQUE SEARCH FIELD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The search input placeholder shows â€œ\u2026â€ as literal text instead of
the ellipsis character â€œâ€¦â€

Find the technique search input in the Training tab bottom sheet.
The placeholder text is rendering the unicode escape instead of the
actual character.

FIX: Replace the placeholder string so it renders as:
â€œSearch techniquesâ€¦â€

NOT:
â€œSearch techniques\u2026â€

Check all placeholder strings in the Training tab for similar issues.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 2: DEFAULT TECHNIQUE CHIPS â€” 4 MAX, NO SCROLL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

The â€œWhat did you work on?â€ section in the bottom sheet needs exactly
4 pre-selected technique chips. NO horizontal scrolling. Just 4 chips
in a single row that fit the screen width.

DEFAULT CHIPS (shown when user has zero logged techniques):

1. Armbar
1. Triangle
1. Half Guard
1. Guard Pass

These must match taxonomy leaf nodes. When the user taps one, it gets
selected (purple highlight) and added to their session log linked to
the correct taxonomy_id.

CHIP STYLING:

- Same style as existing technique chips in the app
- Equal width, evenly spaced across the row
- 4 chips maximum â€” no 5th chip, no scroll, no overflow
- Selected state: purple background, white text
- Unselected state: dark surface, gray/white text

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 3: RECENTS REPLACE DEFAULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

As soon as a user logs a technique (either by tapping a default chip
or typing one manually), that technique becomes a â€œrecent.â€

LOGIC:

- Query the userâ€™s most recently logged techniques from
  training_session_techniques, ordered by created_at DESC
- Deduplicate (same technique logged multiple sessions = show once)
- Take the first 4

DISPLAY RULES:

- If user has 0 recents â†’ show all 4 defaults
- If user has 1 recent â†’ show 1 recent + 3 defaults
- If user has 2 recents â†’ show 2 recents + 2 defaults
- If user has 3 recents â†’ show 3 recents + 1 default
- If user has 4+ recents â†’ show 4 recents, NO defaults

Recents always appear first (left side). Defaults fill remaining slots.

When a user logs a new technique that wasnâ€™t in their recents, it
becomes chip #1 (leftmost) and everything shifts right. The 4th chip
drops off.

The GET /api/training/recent-techniques endpoint should support this
logic. If it doesnâ€™t exist, create it. If it exists, update it.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 4: STREAK ZERO STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Currently the streak counter shows â€œ1 day streakâ€ even when the user
has no active streak. This is wrong.

STREAK LOGIC:

A streak is consecutive days with at least one logged session. A day
without a session breaks the streak.

DISPLAY:

- NO active streak (0 consecutive days, or user has never logged):
  Show: â€œLog a session to start your streakâ€
  Style: secondary gray text, no flame emoji
- ACTIVE streak (1+ consecutive days including today or yesterday):
  Show: â€œğŸ”¥ X day streakâ€
  Style: white text with flame emoji
  
  Note: If user trained today, today counts. If user trained
  yesterday but not today, the streak is still alive (they might
  train later today). If the last session was 2+ days ago, streak
  is broken.

FIX the streak calculation in the backend:

- Query training_sessions for the user ordered by session_date DESC
- Walk backwards from today counting consecutive days
- If yesterday has a session but today doesnâ€™t, streak = yesterdayâ€™s
  count (still alive, not broken yet)
- If the most recent session is 2+ days ago, streak = 0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 5: REMOVE WINS / WORKING ON TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If there is a â€œWinsâ€ / â€œWorking Onâ€ toggle or segmented control in
the bottom sheet technique section, REMOVE IT completely.

All techniques logged are just techniques â€” no categorization needed.
Remove any UI for this toggle and any references to the â€˜categoryâ€™
field in training_session_techniques if it affects the UI. Do NOT
drop the database column â€” just stop using it in the UI.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 6: PROFESSOR OS INSIGHT LINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Add a single line of text from Professor OS that appears on the
Training tab between the streak counter and the calendar grid.

PLACEMENT (top to bottom of Training tab):

1. â€œTrainingâ€ header
1. Streak counter (or zero-state message)
1. â†’ PROFESSOR OS INSIGHT LINE â† (NEW)
1. â€œFebruary 2026â€ calendar header
1. Calendar grid
1. Recent sessions

STYLING:

- ğŸ§  emoji on the left, then the insight text
- Font: same secondary text style used elsewhere in the app
- Color: slightly muted white (white at 70-80% opacity)
- Size: 14px â€” subtle, not dominant
- No card, no border, no background â€” just a line of text
- Padding: 8px top and bottom, same horizontal padding as rest of tab
- Fade-in animation on tab load: 300ms ease-in opacity 0 â†’ 1

BEHAVIOR:

- When user taps a date and the bottom sheet opens â†’ insight line
  fades out (200ms ease-out to opacity 0)
- When user closes the bottom sheet after saving a session â†’
  new insight generates and fades in (300ms)
- When user closes the bottom sheet WITHOUT saving â†’ previous
  insight fades back in

INSIGHT GENERATION â€” RULE-BASED (no AI API call):

This is NOT a Claude API call. It is server-side logic that picks
an insight template based on the userâ€™s training data. Fast, free,
and always available.

Create a function: generateTrainingInsight(userId) that returns a
string. It queries the userâ€™s training_sessions and picks the FIRST
matching rule:

RULE PRIORITY (check in this order, use FIRST match):

1. MILESTONE CHECK
   Query: total session count
- 100+ sessions: â€œ100 sessions logged. Thatâ€™s not casual â€” thatâ€™s commitment.â€
- 50+ sessions: â€œ50 sessions deep. Youâ€™re building something real.â€
- 25+ sessions: â€œ25 sessions in the books. The foundation is forming.â€
- 10+ sessions: â€œDouble digits. Youâ€™re locked in.â€
   
   Only show milestone messages ONCE. Track in a user_milestones
   table or a milestones_shown JSONB column. After shown once,
   skip to next rule.
1. CONSISTENCY CHECK
   Query: sessions in the last 7 days
- 6-7 sessions: â€œ6 days on the mats this week. Thatâ€™s elite.â€
- 5 sessions: â€œ5 sessions this week. Consistency builds champions.â€
- 4 sessions: â€œ4 days this week. Solid work.â€
   
   Query: compare this month vs last month session count
- More this month: â€œYouâ€™re training more this month than last. Momentum.â€
- Equal: â€œHolding steady this month. Consistency is king.â€
1. TECHNIQUE PATTERN CHECK
   Query: most logged technique in last 7 days with count
- If any technique logged 3+ times this week:
  â€œ[Technique] 3 times this week. Thatâ€™s how you sharpen a weapon.â€
- If a technique appears for the first time ever:
  â€œFirst time logging [technique]. Expanding the game.â€
1. STREAK CONTEXT
   Query: current streak length
- 30+ days: â€œ30 day streak. Most people canâ€™t do 7.â€
- 14+ days: â€œTwo weeks straight. This is becoming who you are.â€
- 7+ days: â€œA full week on the mats. Keep building.â€
1. REST DAY AWARENESS
   Query: days since last session
- 2 days off after 5+ day streak:
  â€œTwo days off after a strong run. Recovery is part of the game.â€
- 3-4 days off: â€œThe mats miss you.â€
- 5+ days off: â€œShake the rust off. One session changes everything.â€
1. FALLBACK (if no other rule matches)
- â€œEvery session is a deposit in the bank.â€
- â€œThe best ability is availability. Show up.â€
- â€œTrust the process.â€
  Pick randomly from fallback list.

The function returns ONE string. Short. 1-2 sentences max.
No corporate tone â€” this should sound like a coach, not an app.

ENDPOINT:
GET /api/training/insight?userId=X
Returns: { insight: â€œstringâ€ }

Cache the insight for 1 hour per user. Donâ€™t regenerate on every
tab load â€” only regenerate after a new session is saved or cache expires.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FIX 7: REFRESH INSIGHT AFTER SESSION SAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After a user saves a new training session (POST /api/training/sessions):

1. Invalidate the cached insight for that user
1. The Training tab should re-fetch the insight when the bottom sheet
   closes after a successful save
1. The new insight fades in reflecting the updated data

Example: User had no sessions today. Insight says â€œThe mats miss you.â€
User logs a session. Bottom sheet closes. New insight fades in:
â€œBack on the mats. Thatâ€™s what matters.â€

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTING CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

UNICODE FIX:
â–¡ Search field placeholder shows â€œSearch techniquesâ€¦â€ not â€œ\u2026â€

DEFAULT CHIPS:
â–¡ New user sees: Armbar, Triangle, Half Guard, Guard Pass
â–¡ Exactly 4 chips visible, no scroll
â–¡ Tapping a chip selects it (purple)
â–¡ Tapping again deselects it
â–¡ Chips link to correct taxonomy nodes

RECENTS:
â–¡ Log a session with â€œOmoplataâ€ manually typed
â–¡ Open bottom sheet again â€” â€œOmoplataâ€ is now chip #1
â–¡ Log another session with â€œKimuraâ€
â–¡ Open bottom sheet â€” chips show: Kimura, Omoplata, Half Guard, Guard Pass
â–¡ Log 2 more unique techniques â€” all 4 chips are now recents, zero defaults

STREAK:
â–¡ Delete all sessions for test user
â–¡ Streak shows: â€œLog a session to start your streakâ€
â–¡ Log one session for today
â–¡ Streak shows: â€œğŸ”¥ 1 day streakâ€
â–¡ Log sessions for yesterday and day before
â–¡ Streak shows: â€œğŸ”¥ 3 day streakâ€
â–¡ Delete todayâ€™s session
â–¡ Streak still shows previous days (not broken yet â€” today isnâ€™t over)

WINS/WORKING ON:
â–¡ No toggle visible in bottom sheet
â–¡ Technique section just shows chips and search, nothing else

PROFESSOR OS INSIGHT:
â–¡ Insight line appears between streak and calendar
â–¡ Shows ğŸ§  emoji + text
â–¡ Fades in on tab load (300ms)
â–¡ Tapping a date â†’ insight fades out
â–¡ Saving session â†’ new insight fades in
â–¡ Dismissing sheet without save â†’ old insight returns
â–¡ Insight text matches userâ€™s actual data
â–¡ No API call to Claude â€” fast load, no delay

VISUAL:
â–¡ Everything matches appâ€™s dark theme
â–¡ No layout shifts or jank
â–¡ Insight line doesnâ€™t push calendar down noticeably
â–¡ Chips row looks balanced and clean
â–¡ Works on iPhone Pro Max AND smaller screens (SE, Mini)

DO NOT publish until all checks pass. Show me the Training tab
in preview before deploying.